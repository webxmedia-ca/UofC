# This official base image contains node.js and npm
# specify the node base image with your desired version node:<version>
FROM node:8.12.0

#change the loglevel:
ENV NPM_CONFIG_LOGLEVEL info

ARG VERSION=1.0.0

# log level from command line:
### docker run -e NPM_CONFIG_LOGLEVEL=info node ...
### docker run node npm --loglevel=warn ...

# create the ucautomation folder
RUN mkdir -p /repos/ucautomation
WORKDIR /repos/ucautomation

# Copy the application files
#COPY package.json LICENSE /repos/ucautomation/
#COPY lib /repos/ucautomation/lib/
# my 'COPY' - might not be good:
COPY . /repos/ucautomation

LABEL license=MIT version=$VERSION

# RUN mkdir -p /repos/ucautomation --name creating-dir
# COPY package.json /repos/ucautomation
# COPY . /repos/ucautomation
# --------------------- NODE SHOULD BE RUNNING FROM ABOVE CODE ------------------

# Copy the test files
COPY tests tests
# Override the NODE_ENV environment variable to 'dev', in order to get required test packages
ENV NODE_ENV dev

# 1. Get test packages; AND
# 2. Install our test framework - mocha
# Download the required libraries / packages:
RUN npm install -g npm && \
     npm install --save-dev base-64@0.1.0 && \
     npm install --save-dev chai@4.1.2 && \
     #npm install --save-dev chromedriver@2.42.0 && \
     npm install --save-dev command-line-args@4.0.6 && \
     npm install --save-dev deferred@0.7.9 && \
     npm install --save-dev fs-extra@7.0.0 && \
     npm install --save-dev grunt@1.0.3 && \
     npm install --save-dev grunt-bump@0.8.0 && \
     npm install --save-dev grunt-cli@* && \
     npm install --save-dev grunt-contrib-jshint@* && \
     npm install --save-dev grunt-notify@0.4.5 && \
     npm install --save-dev grunt-sloc@0.7.1 && \
     npm install --save-dev iedriver-exe@3.6.0 && \
     npm install --save-dev jira-client@6.4.1 && \
     npm install --save-dev jshint@2.9.6 && \
     npm install --save-dev jsonfile@3.0.1 && \
     npm install --save-dev load-grunt-config@*&& \
     npm install --save-dev load-grunt-tasks@4.0.0 && \
     npm install --save-dev mocha@5.2.0 && \
     npm install --save-dev moment@2.22.2 && \
     npm install --save-dev selenium-webdriver@4.0.0-alpha.1 && \
     npm install --save-dev time-grunt@*

# replace this with your application's default port
EXPOSE 4444

#CMD ["npm", "start"]
CMD ["npm", "run uclaw:test1 -- --env=tst --browserStack=true"