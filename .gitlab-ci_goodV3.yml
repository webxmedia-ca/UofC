#################################################################################################################
#image: docker
image: git.caas.ucalgary.ca:4567/valeriu.jecov/ucautomation:latest

#################################################################################################################
before_script:
  - echo "this is the before_script in action"
  - npm install
  #  - ls -al $PWD
  - echo "expect docker image to be up - tst env is ready for running the tests"
  - echo

#################################################################################################################
stages:
  #- build_automated_env
  - automation_tests
  - tests_run_automated
  - tests_run_manual

#build_automated_env:
#  stage: build_automated_env
#  image: git.caas.ucalgary.ca:4567/valeriu.jecov/ucautomation:latest
#  script:
#  - npm install
#  - echo "expected docker image to be up - tst env should be ready for tests"


#################################################################################################################
# running 2 groups of automated jobs as we have the ability to have 2 parallel runs within BrowserStack
autoRun_Group1:
  stage: automation_tests
  script:
    - echo "automated test run -------------------------------------------------------------------------------------"
    #  - echo "npm run uclaw:test1 -- --env=tst --appName=ucLaw --browserStack=true"
    - npm run generic:AllUserRolesLoginLogoutSuccessfully -- --env=tst --appName=ucLaw --browserStack=true

    #  --- below there are more examples of running tests (with & without GitLab Variables):
    #  - ${npm_run_test}
    #  - npm run uclaw:test1 -- --env=tst --appName=ucLaw --browserStack=true
    #  - npm run ${testName} -- --env=tst --appName=ucLaw --browserStack=true --browserStackArgs=${browserStackArgs1}
    #  - npm run ${testName} -- --env=${env} --appName=ucLaw --browserStack=true  #this also works
    - echo

#  when: manual
  allow_failure: false

  only:
    - master      # the test/job will run only in master branch

  artifacts:
    reports:
      junit: rspec.xml
  #      junit: ${testName}.xml

  environment:  # not sure what the one below does - is it needed?!
    name: ${env}
    url: https://law-tst.ucalgary.ca


#################################################################################################################
autoRun_Group2:
  stage: automation_tests
  script:
    - echo "automated test run -------------------------------------------------------------------------------------"
    - npm run generic:ValidateInternalMenuAsSiteAdmin -- --env=tst --appName=ucLaw --browserStack=true
    - echo

  #  when: manual
  allow_failure: false

  only:
    - master      # the test/job will run only in master branch

  artifacts:
    reports:
      junit: rspec.xml

  environment:  # not sure what the one below does - is it needed?!
    name: ${env}
    url: https://law-tst.ucalgary.ca


#################################################################################################################
# THE INTENTION OF THE BELOW JOBS / RUNS ARE FOR ALL THE AVAILABLE TESTS TO BE RUN MANUALLY IF / WHEN NEEDED
#################################################################################################################
AllUserRolesLoginLogoutSuccessfully:
  stage: automation_tests
  script:
    - echo "manual test run -------------------------------------------------------------------------------------"
    - npm run generic:AllUserRolesLoginLogoutSuccessfully -- --env=tst --appName=ucLaw --browserStack=true
    - echo

  when: manual
  allow_failure: false

  only:
    - master      # the test/job will run only in master branch

  environment:  # not sure what the one below does - is it needed?!
    name: ${env}
    url: https://law-tst.ucalgary.ca


#################################################################################################################
ValidateInternalMenuAsSiteAdmin:
  stage: automation_tests
  script:
    - echo "manual test run -------------------------------------------------------------------------------------"
    - npm run generic:ValidateInternalMenuAsSiteAdmin -- --env=tst --appName=ucLaw --browserStack=true
    - echo

  when: manual
  allow_failure: false

  only:
    - master      # the test/job will run only in master branch

  environment:  # not sure what the one below does - is it needed?!
    name: ${env}
    url: https://law-tst.ucalgary.ca



#################################################################################################################
after_script:
  - echo "tests run done"